<div class="container">
  <form [formGroup]="addressForm" novalidate (ngSubmit)="onSubmit()">
    <mat-card class="shipping-card">
      <mat-card-header>
        <mat-card-title>Informazioni Stampo</mat-card-title>
      </mat-card-header>
      <mat-card-content>

        <div class="row mt-2 mb-3 align-items-center">
          <div class="col-auto">
            <div class="image">
              <mat-card style="max-width: 200px;">
                <!-- <mat-card-header>
                  <mat-card-title>Immagine</mat-card-title>
                </mat-card-header>
                <img mat-card-image src="https://material.angular.io/assets/img/examples/shiba2.jpg"
                  alt="Photo of a Shiba Inu"> -->
                <mat-card-content>
                  <div class="position-relative">
                    <div class="position-absolute top-50 start-50 translate-middle">
                      <button mat-fab color="primary" [disabled]="addressForm.controls['dieData'].disabled"
                        (click)="openDialog()">
                        <mat-icon>edit</mat-icon>
                      </button>
                    </div>
                    <img style="width: -webkit-fill-available;" [src]="imageURL">

                    @if (addressForm.controls['dieData'].hasError('required')) {
                    <mat-error>Il disegno dello stampo è <strong>obbligatorio</strong></mat-error>
                    }
                    @else if(addressForm.controls['dieData'].hasError('validDie')) {
                    <mat-error>Il disegno dello stampo non è <strong>completo</strong></mat-error>
                    }
                  </div>
                </mat-card-content>
              </mat-card>
            </div>
          </div>
          <div class="col">
            <mat-form-field class="full-width">
              <input matInput placeholder="Nome Stampo" formControlName="name">
              @if (addressForm.controls['name'].hasError('required')) {
              <mat-error>Il nome dello stampo è <strong>obbligatorio</strong></mat-error>
              }
            </mat-form-field>

            <mat-form-field class="full-width">
              <mat-label>Alias</mat-label>
              <mat-chip-grid #chipGrid aria-label="Inserisci un alias">
                @for (alias of aliases; track alias) {
                <mat-chip-row (removed)="remove(alias)" [editable]="true" (edited)="edit(alias, $event)"
                  [aria-description]="'premi invio per modificare ' + alias">
                  {{alias}}
                  <button matChipRemove [attr.aria-label]="'elimina ' + alias">
                    <mat-icon>cancel</mat-icon>
                  </button>
                </mat-chip-row>
                }
                <input placeholder="Nuovo alias..." formControlName="alias" [matChipInputFor]="chipGrid"
                  [matChipInputSeparatorKeyCodes]="separatorKeysCodes" [matChipInputAddOnBlur]="addOnBlur"
                  (matChipInputTokenEnd)="add($event)" />
              </mat-chip-grid>
            </mat-form-field>
          </div>
        </div>

        <div class="row">
          <mat-form-field class="col">
            <mat-label>Cliente</mat-label>
            <input type="text" placeholder="Seleziona un cliente" aria-label="Customer" matInput
              formControlName="customer" [matAutocomplete]="auto">
            <mat-autocomplete #auto="matAutocomplete">
              @for (customer of filteredCustomers | async; track customer) {
              <mat-option [value]="customer">{{customer}}</mat-option>
              }
            </mat-autocomplete>
            @if (addressForm.controls['customer'].hasError('required')) {
            <mat-error>Il nome del cliente è <strong>obbligatorio</strong></mat-error>
            }
            @else if (addressForm.controls['customer'].hasError('minlength')) {
            <mat-error>Il nome del cliente deve essere lungo almeno 2 caratteri</mat-error>
            }
          </mat-form-field>
        </div>

        <div class="row">
          <div class="col">
            <mat-form-field class="full-width">
              <input matInput placeholder="Altri dati..." formControlName="data">
            </mat-form-field>
          </div>
        </div>
        <!-- <div class="row">
          <div class="col">
            <mat-form-field class="full-width">
              <input matInput placeholder="First name" formControlName="firstName">
              @if (addressForm.controls['firstName'].hasError('required')) {
              <mat-error>First name is <strong>required</strong></mat-error>
              }
            </mat-form-field>
          </div>
          <div class="col">
            <mat-form-field class="full-width">
              <input matInput placeholder="Last name" formControlName="lastName">
              @if (addressForm.controls['lastName'].hasError('required')) {
              <mat-error>Last name is <strong>required</strong></mat-error>
              }
            </mat-form-field>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <mat-form-field class="full-width">
              <textarea matInput placeholder="Address" formControlName="address"></textarea>
              @if (addressForm.controls['address'].hasError('required')) {
              <mat-error>Address is <strong>required</strong></mat-error>
              }
            </mat-form-field>
          </div>
        </div>
        <div class="row">
          <div class="col">
            @if (hasUnitNumber) {
            <mat-form-field class="full-width">
              <textarea matInput placeholder="Address 2" formControlName="address2"></textarea>
            </mat-form-field>
            } @else {
            <button mat-button type="button" (click)="hasUnitNumber = !hasUnitNumber">
              + Add C/O, Apt, Suite, Unit
            </button>
            }
          </div>
        </div>
        <div class="row">
          <div class="col">
            <mat-form-field class="full-width">
              <input matInput placeholder="City" formControlName="city">
              @if (addressForm.controls['city'].hasError('required')) {
              <mat-error>City is <strong>required</strong></mat-error>
              }
            </mat-form-field>
          </div>
          <div class="col">
            <mat-form-field class="full-width">
              <mat-select placeholder="State" formControlName="state">
                @for (state of states; track state) {
                <mat-option [value]="state.abbreviation">{{ state.name }}</mat-option>
                }
              </mat-select>
              @if (addressForm.controls['state'].hasError('required')) {
              <mat-error>State is <strong>required</strong></mat-error>
              }
            </mat-form-field>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <mat-form-field class="full-width">
              <input matInput #postalCode maxlength="5" placeholder="Postal Code" type="number"
                formControlName="postalCode">
              <mat-hint align="end">{{postalCode.value.length}} / 5</mat-hint>
            </mat-form-field>
          </div>
        </div>
        <div class="row">
          <div class="col">
            <mat-radio-group formControlName="shipping">
              <mat-radio-button value="free">Free Shipping</mat-radio-button>
              <mat-radio-button value="priority">Priority Shipping</mat-radio-button>
              <mat-radio-button value="nextday">Next Day Shipping</mat-radio-button>
            </mat-radio-group>
          </div>
        </div> -->
      </mat-card-content>
      <mat-card-actions style="flex-direction: row-reverse;">
        <button mat-raised-button color="primary" type="submit">Crea</button>
      </mat-card-actions>
    </mat-card>
  </form>
</div>